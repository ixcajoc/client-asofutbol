<!-- <div class="min-h-screen bg-gray-50 dark:bg-neutral-900 py-8"> -->
<div class="min-h-screen dark:bg-neutral-900 py-8">
  <div class="container mx-auto px-4">
    <!-- Header + Filtros -->
    <div class="mb-6">
      <app-banner [title]="'Reportes'"></app-banner>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
        <!-- Búsqueda -->
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-gray-600 dark:text-neutral-300 mb-1">Buscar</label>
          <div class="relative">
            <input
              type="text"
              class="w-full px-3 py-2 pl-9 rounded-lg border border-gray-300 dark:border-neutral-700 dark:bg-neutral-800 dark:text-white focus:ring-2 focus:ring-rose-500"
              placeholder="Nombre, equipo o posición..."
              [(ngModel)]="search"
              (input)="applyFilters()"
            />
            <svg class="absolute left-3 top-2.5 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>

        <!-- Equipo -->
        <div>
          <label class="block text-xs font-medium text-gray-600 dark:text-neutral-300 mb-1">Equipo</label>
          <select
            class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-neutral-700 dark:bg-neutral-800 dark:text-white focus:ring-2 focus:ring-rose-500"
            [(ngModel)]="selectedTeam"
            (change)="applyFilters()"
          >
            <option *ngFor="let t of teams" [ngValue]="t">{{ t }}</option>
          </select>
        </div>

        <!-- Posición -->
        <div>
          <label class="block text-xs font-medium text-gray-600 dark:text-neutral-300 mb-1">Posición</label>
          <select
            class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-neutral-700 dark:bg-neutral-800 dark:text-white focus:ring-2 focus:ring-rose-500"
            [(ngModel)]="selectedPosition"
            (change)="applyFilters()"
          >
            <option value="TODAS">TODAS</option>
            <option *ngFor="let p of positions" [ngValue]="p">{{ p }}</option>
          </select>
        </div>
      </div>

      <div class="mt-3 flex items-center justify-between flex-wrap gap-4">
        <div class="flex items-center gap-6 text-sm">
          <span class="text-gray-600 dark:text-gray-400">Total goles: <span class="font-semibold text-gray-900 dark:text-white">{{ getTotalGoals() }}</span></span>
          <span class="text-gray-600 dark:text-gray-400">Promedio global: <span class="font-semibold text-gray-900 dark:text-white">{{ getGlobalGoalsAvg() }}</span></span>
          <span class="text-gray-600 dark:text-gray-400">Jugadores: <span class="font-semibold text-gray-900 dark:text-white">{{ filteredList.length }}</span></span>
        </div>
        <app-export-button [tableData]="exportData"></app-export-button>
      </div>
    </div>

    <!-- Tabla Desktop -->
    <div class="hidden lg:block bg-white dark:bg-neutral-800 rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-neutral-700">
      <div class="bg-gradient-to-r from-rose-600 to-red-600 px-6 py-4">
        <h2 class="text-xl font-bold text-white flex items-center gap-2">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path d="M6 2a1 1 0 000 2h2l1 2h2l1-2h2a1 1 0 100-2H6zM4 8a1 1 0 011-1h10a1 1 0 011 1v6.5A2.5 2.5 0 0113.5 17h-7A2.5 2.5 0 014 14.5V8z"></path>
          </svg>
          Top Goleadores
        </h2>
        <p class="text-rose-100 text-sm mt-1">Goles, asistencias y promedio por partido</p>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-gray-50 dark:bg-neutral-900 border-b-2 border-gray-200 dark:border-neutral-700">
            <tr>
              <th class="px-4 py-3 text-left">
                <span class="text-xs font-bold text-gray-600 dark:text-neutral-400 uppercase tracking-wider">#</span>
              </th>
              <th class="px-6 py-3 text-left">
                <span class="text-xs font-bold text-gray-600 dark:text-neutral-400 uppercase tracking-wider">Jugador</span>
              </th>
              <th class="px-4 py-3 text-left">
                <span class="text-xs font-bold text-gray-600 dark:text-neutral-400 uppercase tracking-wider">Equipo</span>
              </th>
              <th class="px-3 py-3 text-center">
                <span class="text-xs font-bold text-gray-600 dark:text-neutral-400 uppercase">PJ</span>
              </th>
              <!-- Ordenables -->
              <th class="px-3 py-3 text-center cursor-pointer select-none" (click)="sortBy('goles')">
                <span class="text-xs font-bold uppercase text-gray-600 dark:text-neutral-400">Goles</span>
                <span *ngIf="sortKey === 'goles'">
                  <span class="ml-1 text-gray-400" [ngClass]="{'rotate-180 inline-block': sortDir === 'asc'}">▲</span>
                </span>
              </th>
              <th class="px-3 py-3 text-center cursor-pointer select-none" (click)="sortBy('asistencias')">
                <span class="text-xs font-bold uppercase text-gray-600 dark:text-neutral-400">Asist.</span>
                <span *ngIf="sortKey === 'asistencias'">
                  <span class="ml-1 text-gray-400" [ngClass]="{'rotate-180 inline-block': sortDir === 'asc'}">▲</span>
                </span>
              </th>
              <th class="px-4 py-3 text-center cursor-pointer select-none" (click)="sortBy('promedio')">
                <span class="text-xs font-bold uppercase text-gray-600 dark:text-neutral-400">Promedio G.</span>
                <span *ngIf="sortKey === 'promedio'">
                  <span class="ml-1 text-gray-400" [ngClass]="{'rotate-180 inline-block': sortDir === 'asc'}">▲</span>
                </span>
              </th>
              <th class="px-4 py-3 text-center cursor-pointer select-none" (click)="sortBy('aporte')">
                <span class="text-xs font-bold uppercase text-gray-600 dark:text-neutral-400">Aporte</span>
                <span *ngIf="sortKey === 'aporte'">
                  <span class="ml-1 text-gray-400" [ngClass]="{'rotate-180 inline-block': sortDir === 'asc'}">▲</span>
                </span>
              </th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray-200 dark:divide-neutral-700">
            @for (player of filteredList; track $index) {
              <tr class="group hover:bg-rose-50 dark:hover:bg-neutral-700/50 transition-colors">
                <!-- Ranking -->
                <td class="px-4 py-4">
                  @if ($index < 3) {
                    <span 
                      class="inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold text-white"
                      [ngClass]="{
                        'bg-yellow-500': $index === 0,
                        'bg-gray-400': $index === 1,
                        'bg-orange-600': $index === 2
                      }"
                    >
                      {{ $index + 1 }}
                    </span>
                  } @else {
                    <span class="text-sm font-semibold text-gray-600 dark:text-gray-400">{{ $index + 1 }}</span>
                  }
                </td>

                <!-- Jugador -->
                <td class="px-6 py-4">
                  <div class="flex items-center gap-3">
                    <!-- Dorsal -->
                    <div class="relative">
                      <div 
                        class="w-10 h-10 rounded-full flex items-center justify-center text-white text-xs font-bold"
                        [ngClass]="getPositionGradient(player.posicion)"
                      >
                        {{ player.numero_camiseta }}
                      </div>
                      <div 
                        class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full border-2 border-white dark:border-neutral-800 flex items-center justify-center text-[8px] font-bold"
                        [ngClass]="getPositionBadgeColor(player.posicion)"
                        [title]="player.posicion"
                      >
                        {{ getPositionAbbr(player.posicion) }}
                      </div>
                    </div>

                    <div class="min-w-0">
                      <p class="text-sm font-semibold text-gray-900 dark:text-white truncate">
                        {{ player.nombre }} {{ player.apellido }}
                      </p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">
                        {{ player.posicion }}
                      </p>
                    </div>
                  </div>
                </td>

                <!-- Equipo -->
                <td class="px-4 py-4">
                  <span class="text-sm text-gray-700 dark:text-neutral-300 font-medium truncate max-w-[180px] inline-block" [title]="player.equipo">
                    {{ player.equipo }}
                  </span>
                </td>

                <!-- PJ -->
                <td class="px-3 py-4 text-center text-sm text-gray-700 dark:text-neutral-300 font-medium">
                  {{ player.partidos_jugados }}
                </td>

                <!-- Goles -->
                <td class="px-3 py-4 text-center">
                  <span class="inline-flex items-center justify-center px-2.5 py-1 rounded-full text-sm font-bold bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300">
                    {{ player.goles }}
                  </span>
                </td>

                <!-- Asistencias -->
                <td class="px-3 py-4 text-center">
                  <span class="inline-flex items-center justify-center px-2.5 py-1 rounded-full text-sm font-semibold bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300">
                    {{ player.asistencias }}
                  </span>
                </td>

                <!-- Promedio goles -->
                <td class="px-4 py-4 text-center">
                  <span 
                    class="text-sm font-bold"
                    [ngClass]="getGoalsAvgColorClass(getGoalsAverageNumber(player.goles, player.partidos_jugados))"
                  >
                    {{ getGoalsAverage(player.goles, player.partidos_jugados) }}
                  </span>
                </td>

                <!-- Aporte ofensivo (Goles + Asist por partido) -->
                <td class="px-4 py-4">
                  <div class="flex items-center justify-center gap-3">
                    <div class="text-center">
                      <div class="w-24 h-2 rounded-full bg-gray-200 dark:bg-neutral-700 overflow-hidden">
                        <div 
                          class="h-full rounded-full bg-gradient-to-r from-rose-500 to-emerald-500 transition-all duration-500"
                          [style.width.%]="getContributionPct(player.goles, player.asistencias, player.partidos_jugados)"
                        ></div>
                      </div>
                      <div class="text-[11px] text-gray-500 dark:text-gray-400 mt-1">
                        {{ getContributionPct(player.goles, player.asistencias, player.partidos_jugados) | number:'1.0-0' }}%
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Leyenda -->
      <div class="bg-gray-50 dark:bg-neutral-900 px-6 py-4 border-t border-gray-200 dark:border-neutral-700">
        <div class="flex flex-wrap items-center gap-4 text-xs">
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full bg-rose-500"></span>
            <span class="text-gray-600 dark:text-neutral-400">Goles</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full bg-emerald-500"></span>
            <span class="text-gray-600 dark:text-neutral-400">Asistencias</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista Mobile: Cards -->
    <div class="lg:hidden space-y-3">
      @for (player of filteredList; track $index) {
        <div class="bg-white dark:bg-neutral-800 rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-neutral-700 hover:shadow-lg transition">
          <div class="p-4 bg-gradient-to-r from-rose-50 to-emerald-50 dark:from-neutral-900 dark:to-neutral-800">
            <div class="flex items-start justify-between">
              <div class="flex items-center gap-3">
                <!-- Ranking -->
                @if ($index < 3) {
                  <span 
                    class="flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold text-white"
                    [ngClass]="{
                      'bg-yellow-500': $index === 0,
                      'bg-gray-400': $index === 1,
                      'bg-orange-600': $index === 2
                    }"
                  >
                    {{ $index + 1 }}
                  </span>
                } @else {
                  <span class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-200 dark:bg-neutral-700 text-sm font-bold text-gray-700 dark:text-gray-300">
                    {{ $index + 1 }}
                  </span>
                }

                <!-- Avatar -->
                <div class="relative">
                  <div 
                    class="w-12 h-12 rounded-full flex items-center justify-center text-white text-sm font-bold"
                    [ngClass]="getPositionGradient(player.posicion)"
                  >
                    {{ player.numero_camiseta }}
                  </div>
                  <div 
                    class="absolute -bottom-1 -right-1 w-6 h-6 rounded-full border-2 border-white dark:border-neutral-800 flex items-center justify-center text-[9px] font-bold"
                    [ngClass]="getPositionBadgeColor(player.posicion)"
                  >
                    {{ getPositionAbbr(player.posicion) }}
                  </div>
                </div>

                <div>
                  <h3 class="text-sm font-bold text-gray-900 dark:text-white">
                    {{ player.nombre }} {{ player.apellido }}
                  </h3>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    {{ player.equipo }} • {{ player.posicion }}
                  </p>
                </div>
              </div>

              <!-- Goles -->
              <div class="text-right">
                <div class="text-2xl font-bold text-rose-600 dark:text-rose-400">
                  {{ player.goles }}
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">goles</div>
              </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-3 gap-3 mt-4">
              <div class="text-center">
                <div class="text-[11px] text-gray-500 dark:text-gray-400">PJ</div>
                <div class="text-sm font-bold text-gray-900 dark:text-white">{{ player.partidos_jugados }}</div>
              </div>
              <div class="text-center">
                <div class="text-[11px] text-gray-500 dark:text-gray-400">Asist.</div>
                <div class="text-sm font-bold text-emerald-600 dark:text-emerald-400">{{ player.asistencias }}</div>
              </div>
              <div class="text-center">
                <div class="text-[11px] text-gray-500 dark:text-gray-400">Prom. G.</div>
                <div class="text-sm font-bold" [ngClass]="getGoalsAvgColorClass(getGoalsAverageNumber(player.goles, player.partidos_jugados))">
                  {{ getGoalsAverage(player.goles, player.partidos_jugados) }}
                </div>
              </div>
            </div>

            <!-- Aporte -->
            <div class="mt-4">
              <div class="flex items-center justify-between text-xs text-gray-600 dark:text-gray-400 mb-1">
                <span>Aporte ofensivo</span>
                <span class="font-semibold">{{ getContributionPct(player.goles, player.asistencias, player.partidos_jugados) | number:'1.0-0' }}%</span>
              </div>
              <div class="w-full bg-gray-200 dark:bg-neutral-700 rounded-full h-2 overflow-hidden">
                <div 
                  class="h-full rounded-full bg-gradient-to-r from-rose-500 to-emerald-500 transition-all duration-500"
                  [style.width.%]="getContributionPct(player.goles, player.asistencias, player.partidos_jugados)"
                ></div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Empty state -->
    @if (filteredList.length === 0) {
      <div class="bg-white dark:bg-neutral-800 rounded-2xl shadow-xl p-12 text-center">
        <svg class="mx-auto h-16 w-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414A1 1 0 0116 19v2a2 2 0 01-2 2z"></path>
        </svg>
        <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No hay datos de goleadores</h3>
        <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Se mostrarán cuando existan registros.</p>
      </div>
    }
  </div>
</div>